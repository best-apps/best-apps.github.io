<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>linux-cè¯­è¨€-æ¶ˆæ¯é˜Ÿåˆ—-ç¼–ç¨‹å®ç°</title>
    <meta name="baidu-site-verification" content="UEKwThMjA1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="MobileOptimized" content="width">
	<meta name="HandheldFriendly" content="true">
   
  <meta name="keywords" content="linux,cè¯­è¨€,æ¶ˆæ¯é˜Ÿåˆ—,msgrcv,msgget">
 
  
    <meta name="description" content="linux-cè¯­è¨€-æ¶ˆæ¯é˜Ÿåˆ—,è…¾è¾¾æ ¼å°”åšå®¢">
  
    <meta name="author" content="è…¾è¾¾æ ¼å°”">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/twitter/stylesheets/bootstrap.min.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/stylesheets/style.css" type="text/css" rel="stylesheet" media="all">
<link href="/assets/twitter/widgets/google_prettify/stylesheets/twitter-bootstrap.css" type="text/css" rel="stylesheet" media="all">
 

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->
  </head>

  <body>

    <div class="navbar">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">è…¾è¾¾æ ¼å°”çš„åšå®¢</a>
          <ul class="nav">
            
              


  <li><a href="/archive">Archive</a></li>


            
              


  <li><a href="/tags">Tags</a></li>


            
              


  <li><a href="/categories">Categories</a></li>


            
              


  <li><a href="/pages">Pages</a></li>


            
              


  <li><a href="/about">About</a></li>


            
            æ¬²ç©·åƒé‡Œç›®ï¼Œæ›´ä¸Šä¸€å±‚æ¥¼ã€‚å±…é«˜å£°è‡ªè¿œ,éæ˜¯è—‰ç§‹é£ã€‚
          </ul>
        </div>
      </div>
    </div>

    <div class="container">

      <div class="content">
        <div class="page-header">
  <h1>linux-cè¯­è¨€-æ¶ˆæ¯é˜Ÿåˆ—-ç¼–ç¨‹å®ç° </h1>
</div>

<div class="row">
  <div class="span8">
    <h1><a style="display: block;" name="å‘é€æ¶ˆæ¯" href="#å‘é€æ¶ˆæ¯"></a>å‘é€æ¶ˆæ¯</h1>

<h2><a style="display: block;" name="ç¨‹åºä»£ç -msgsend.c" href="#ç¨‹åºä»£ç -msgsend.c"></a>ç¨‹åºä»£ç  msgsend.c</h2>

<pre><code>#include &lt;unistd.h&gt;  
#include &lt;stdlib.h&gt;  
#include &lt;stdio.h&gt;  
#include &lt;string.h&gt;  
#include &lt;sys/msg.h&gt;  
#include &lt;errno.h&gt;  

#define MAX_TEXT 512  
struct msg_st  
{  
    long int msg_type;  
    char text[MAX_TEXT];  
};  

int main()  
{  
    int running = 1;  
    struct msg_st data;  
    char buffer[BUFSIZ];  
    int msgid = -1;  

    //å»ºç«‹æ¶ˆæ¯é˜Ÿåˆ—  
    msgid = msgget((key_t)1234, 0666 | IPC_CREAT);  
    if(msgid == -1)  
    {  
        fprintf(stderr, &quot;msgget failed with error: %d\n&quot;, errno);  
        exit(EXIT_FAILURE);  
    }  

    //å‘æ¶ˆæ¯é˜Ÿåˆ—ä¸­å†™æ¶ˆæ¯ï¼Œç›´åˆ°å†™å…¥end  
    while(running)  
    {  
        //è¾“å…¥æ•°æ®  
        printf(&quot;Enter some text: &quot;);  
        fgets(buffer, BUFSIZ, stdin);  
        data.msg_type = 1;    //æ³¨æ„2  
        strcpy(data.text, buffer);  
        //å‘é˜Ÿåˆ—å‘é€æ•°æ®  
        if(msgsnd(msgid, (void*)&amp;data, MAX_TEXT, 0) == -1)  
        {  
            fprintf(stderr, &quot;msgsnd failed\n&quot;);  
            exit(EXIT_FAILURE);  
        }  
        //è¾“å…¥endç»“æŸè¾“å…¥  
        if(strncmp(buffer, &quot;end&quot;, 3) == 0)  
            running = 0;  
        sleep(1);  
    }  
    exit(EXIT_SUCCESS);  
}  
</code></pre>

<h2><a style="display: block;" name="ç¼–è¯‘" href="#ç¼–è¯‘"></a>ç¼–è¯‘</h2>

<pre><code>gcc -o msgsend msgsend.c -lm 
</code></pre>

<h2><a style="display: block;" name="æ‰§è¡Œ" href="#æ‰§è¡Œ"></a>æ‰§è¡Œ</h2>

<pre><code>./msgsend 
</code></pre>

<h1><a style="display: block;" name="æ¥æ”¶æ¶ˆæ¯" href="#æ¥æ”¶æ¶ˆæ¯"></a>æ¥æ”¶æ¶ˆæ¯</h1>

<h2><a style="display: block;" name="ç¨‹åºä»£ç -msgrecv.c" href="#ç¨‹åºä»£ç -msgrecv.c"></a>ç¨‹åºä»£ç  msgrecv.c</h2>

<pre><code>#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;errno.h&gt;
#include &lt;sys/msg.h&gt;

struct msg_st
{
    long int msg_type;
    char text[BUFSIZ];
};

int main()
{
int running = 1;
int msgid = -1;
struct msg_st data;
long int msgtype = 0; //æ³¨æ„1

//å»ºç«‹æ¶ˆæ¯é˜Ÿåˆ—
msgid = msgget((key_t)1234, 0666 | IPC_CREAT);
if(msgid == -1)
{
    fprintf(stderr, &quot;msgget failed with error: %d\n&quot;, errno);
    exit(EXIT_FAILURE);
}
//ä»é˜Ÿåˆ—ä¸­è·å–æ¶ˆæ¯ï¼Œç›´åˆ°é‡åˆ°endæ¶ˆæ¯ä¸ºæ­¢
while(running)
{
    if(msgrcv(msgid, (void*)&amp;data, BUFSIZ, msgtype, 0) == -1)
    {
        fprintf(stderr, &quot;msgrcv failed with errno: %d\n&quot;, errno);
        exit(EXIT_FAILURE);
    }
    printf(&quot;You wrote: %s\n&quot;,data.text);
    //é‡åˆ°endç»“æŸ
    if(strncmp(data.text, &quot;end&quot;, 3) == 0)
        running = 0;
}
//åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—
if(msgctl(msgid, IPC_RMID, 0) == -1)
{
    fprintf(stderr, &quot;msgctl(IPC_RMID) failed\n&quot;);
    exit(EXIT_FAILURE);
}
exit(EXIT_SUCCESS);
}
</code></pre>

<h2><a style="display: block;" name="ç¼–è¯‘" href="#ç¼–è¯‘"></a>ç¼–è¯‘</h2>

<pre><code>gcc -o msgrecv msgrecv.c -lm 
</code></pre>

<h2><a style="display: block;" name="è¿è¡Œ" href="#è¿è¡Œ"></a>è¿è¡Œ</h2>

<pre><code>./msgrecv
</code></pre>

    <hr>
    <div class="pagination">
      <ul>
        <ul>
          
            <li class="prev"><a href="/experience/go-oci8_for_windows.html" title="goè¯­è¨€åœ¨windows8è®¿é—®oracle">&larr; Previous</a></li>
          
          

            <li><a href="/archive">Archive</a></li>

          
            <li class="next"><a href="/code/linux/linux_c_base64.html" title="linux-cè¯­è¨€-base64åŠ å¯†è§£å¯†ç¼–ç¨‹å®ç°">Next &rarr;</a></li>
          
          
        </ul>
      </ul>
    </div>
    <hr>
    
<div id="disqus_thread"></div>
<script>
    var disqus_developer = 1;
    var disqus_shortname = 'bestappsnowcom'; // required: replace example with your forum shortname
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>

  </div>
  
  <div class="span4">
    <h4>Published</h4>
    <div class="date"><span>2014-09-19</span></div>
    <br>
    <h4>Categories</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/categories/#%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-ref">å­¦ä¹ ç¬”è®° <span>4</span></a>
</li>
    
    </ul>
    <br>
    <h4>Tags</h4>
    <ul class="tag_box">
    
      <li>
  <a href="/tags/#linux-ref">linux <span>2</span></a>
</li>
    
    </ul>
  </div>
</div>

      </div>

      <footer>
    
       
          <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{},"image":{"viewList":[],"viewText":"·ÖÏíµ½£º","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":[]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script> 
         å‘ç€æ¢¦æƒ³å‡ºå‘ï¼Œè™½ç„¶æˆ‘ç¾½ç¿¼æœªä¸°ï¼Œä½†æˆ‘æœ‰ä¹˜é£ç ´æµªçš„å‹‡æ°”ï¼Œæœ‰æ¢¦æƒ³æˆçœŸçš„ä¿¡å¿ƒã€‚    <br>
        &copy; è…¾è¾¾æ ¼å°” 2014 
          with help from <a href="http://github.com/wendal/gor" target="_blank" title="Gor -- Fast Blog">Gor</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
		  and Idea from <a href="http://ruhoh.com" target="_blank" title="The Definitive Technical Blogging Framework">ruhoh</a>
     
      </footer>

    </div> <!-- /container -->
    <!--
    
     -->
    
    
    
  </body>
</html>
